# Builds the release and publishes to Maven Central
name: Build release

on:
  release:
    types: [ published ]

jobs:
  extract_version:
    runs-on: ubuntu-latest
    outputs:
      version: ${{ steps.version.outputs.version }}
    steps:
      - name: Extract version from tag
        id: version
        run: echo "version=${GITHUB_REF_NAME#v}" >> $GITHUB_OUTPUT

  build:
    needs: extract_version
    uses: xemantic/.github/.github/workflows/build-gradle.yml@main
    secrets:
      env_secrets: |
        ANTHROPIC_API_KEY=${{ secrets.ANTHROPIC_API_KEY }}
    with:
      gradle_args: -Pversion=${{ needs.extract_version.outputs.version }} -PjvmOnlyBuild=false build publishToMavenCentral jreleaserAnnounce --no-configuration-cache
      maven_central: true
      jreleaser: true
